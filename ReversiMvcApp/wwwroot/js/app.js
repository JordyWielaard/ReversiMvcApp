const Game=function(){let a;function o(e){Game.Model.getGameState(e).then(e=>{var t={bord:JSON.parse(e.bord)};Game.Reversi.printBord(t);var n={aanzet:Game.Model.getAanzet(e.speler1Token),speler:"Speler 1",kleur:"Zwart"},t={aanzet:Game.Model.getAanzet(e.speler2Token),speler:"Speler 2",kleur:"Wit"};Game.Reversi.showSpelers(n,t);t={omschrijving:e.omschrijving,kleur:Game.Model.getPlayerColor(Game.Model.getSpelerToken())};Game.Reversi.huidigeSpeler(t),Game.Stats.updateStats(),e.afgelopen&&(r("feedback"),e.winnaar==e.speler1Token||e.winnaar==e.speler2Token?a.show("Het spel is afgelopen. De winnaar is: "+Game.Model.getPlayerColor(e.winnaar),"success"):a.show("Het spel is afgelopen. Het is "+e.winnaar,"success"))}).catch(e=>{console.log(e)})}const r=function(e){e=document.getElementById(e);"none"===e.style.display&&(e.style.display="block")};return{init:function(e,t,n){a=new FeedbackWidget("Winnaar"),Game.Reversi.init(),Game.Model.init(n),Game.Stats.init(n),Game.Model.getCurrentPlayer(t),o(e),setInterval(function(){o(e)},5e3)}}}();$(function(){let e=new FeedbackWidget("feedback-danger");console.log("ready!"),$("#selector").on("click",function(){e.show(),alert("The button was clicked.")})});var logs=0;class FeedbackWidget{constructor(e){this._elementId=e}get elementId(){return this._elementId}log(e){localStorage.setItem(logs,JSON.stringify(e)),9<localStorage.length&&localStorage.removeItem(localStorage.key(0)),logs++}removeLog(){localStorage.clear()}history(){for(let e=0;e<localStorage.length;e++){var t=JSON.stringify(new Array(localStorage.getItem(e).message,localStorage.getItem(e).type));console.log(t+"\n")}}show(e,t){$("#feedbackText").text(e),"success"==t?($("#feedback").removeClass("alert alert-danger"),$("#feedback").addClass("alert alert-success")):($("#feedback").removeClass("alert alert-success"),$("#feedback").addClass("alert alert-danger")),$("#feedback").removeClass("fadeOut"),$("#feedback").addClass("fadeIn"),this.log({message:e,type:t})}hide(){$("#feedback").removeClass("fadeIn"),$("#feedback").addClass("fadeOut")}}Game.API={getRandomPoke:function(){var e=Math.floor(898*Math.random())+1;Game.Data.get("https://pokeapi.co/api/v2/pokemon-form/"+e).then(function(e){e=e.sprites.front_shiny;Game.Reversi.apiDataParse("api",e)})}},Game.Data=function(){let r={environment:"production"};var l={mock:[{url:"api/Spel/Beurt",data:0}]};return{init:function(e){"production"==e||"development"==e?r=e:new Error("Enviroment heeft een verkeerde waarde")},get:function(o){return new Promise(function(e,t){var n,a;"production"==r?e((a=o,console.log(a),new Promise((t,n)=>{$.ajax({url:a,data:{},success:function(e){t(e)},error:function(e){n(e)},type:"GET"})}))):t((n=l.mock,new Promise(function(e,t){e(n)})))})},post:function(e,a){return console.log(e),new Promise(function(t,n){$.ajax({url:e,data:JSON.stringify(a),headers:{Accept:"application/json","Content-Type":"application/json"},success:function(e){t(e)},error:function(e){n(e)},type:"POST"})})}}}(),Game.Model=function(){let a,o,t;return{init:function(e){a=e},getGameState:function(n){return new Promise(function(t,e){null!=n?Game.Data.get(a+"api/Spel/"+n).then(e=>{o=e,t(e)}).catch(e=>{console.log(e)}):e("Token is leeg")})},getSpelerToken:function(){return t},getSpelToken:function(){return o.token},getCurrentPlayer:function(e){t=e},postZet:function(n){return new Promise(function(e,t){null!=n?Game.Data.post(a+"api/Spel/Zet",n).then(e=>{Game.API.getRandomPoke()}).catch(e=>{console.log(e)}):t("Geen x en y gegeven")})},postOpgeven:function(n){return new Promise(function(e,t){null!=n?Game.Data.post(a+"api/Spel/Opgeven",n).then(e=>{Game.API.getRandomPoke()}).catch(e=>{console.log(e)}):t("Incorrecte data")})},getAanzet:function(e){return e==o.speler1Token&&2==o.aandeBeurt||e==o.speler2Token&&1==o.aandeBeurt?1:2},getPlayerColor:function(e){return e==o.speler1Token?"Zwart":"Wit"}}}(),Game.Reversi=function(){function e(){var e={X:0,Y:0,SpelerToken:Game.Model.getSpelerToken(),SpelToken:Game.Model.getSpelToken(),Pas:!0};Game.Model.postZet(e)}function t(){var e={SpelerToken:Game.Model.getSpelerToken(),SpelToken:Game.Model.getSpelToken()};Game.Model.postOpgeven(e)}return{init:function(){$("#buttonpas").click(e),$("#buttonopgeven").click(t),Game.Data.init("production")},printBord:function(e){$("#spelBord").html(Game.Template.parseTemplate("bord",e))},showFiche:function(n){$("#bord").children().each(function(e,t){n==t&&(e={X:e%8,Y:~~(e/8),SpelerToken:Game.Model.getSpelerToken(),SpelToken:Game.Model.getSpelToken(),Pas:!1},Game.Model.postZet(e))})},pas:e,opgeven:t,apiDataParse:function(e,t){$("#api").html(Game.Template.parseTemplate(e,t))},showSpelers:function(e,t){$("#speler1").html(Game.Template.parseTemplate("spelers",e)),$("#speler2").html(Game.Template.parseTemplate("spelers",t))},huidigeSpeler:function(e){$("#huidigeSpeler").html(Game.Template.parseTemplate("huidigeSpeler",e))}}}(),Game.Stats=function(){let n;const e=function(){return new Promise(function(o,e){var t=Game.Model.getSpelToken();Game.Data.get(n+"api/Spel/PieceHistory/"+t).then(function(e){var t,n,a=JSON.parse(e);for(t in playerPieceHistory={player1:[],player2:[]},a[0])playerPieceHistory.player1.push(a[0][t]);for(n in a[1])playerPieceHistory.player2.push(a[1][n]);o(playerPieceHistory)}).catch(function(e){console.log(e)})})},t=function(e){$("#chart").html(Game.Template.parseTemplate("stats",e))};return{init:function(e){n=e},updateStats:function(){e().then(e=>{t(e)})}}}(),Game.Template={parseTemplate:function(e,t){return(e=e,spa_templates.templates[e])(t)}};